"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[530],{4530:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var r=n(20698),i=n(95155),l=n(12115),o=n(13199),a=n(37903),s=n(20450),c=n.n(s),d=n(5565),u=n(65285);function h(){let e=(0,r._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n"]);return h=function(){return e},e}function g(){let e=(0,r._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return g=function(){return e},e}function f(){let e=(0,r._)(["\n  cursor: pointer;\n"]);return f=function(){return e},e}function x(){let e=(0,r._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return x=function(){return e},e}let w=window.innerWidth,p=window.innerHeight,m=e=>e.map(e=>({...e})),j=e=>{let{src:t,shapeProps:n,isSelected:r,onSelect:a,onChange:s}=e,[d]=c()(t,"anonymous"),u=(0,l.useRef)(),h=(0,l.useRef)();return(0,l.useEffect)(()=>{r&&h.current.nodes([u.current]),r&&h.current&&u.current&&(h.current.nodes([u.current]),h.current.getLayer().batchDraw())},[r]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o._V,{image:d,onClick:a,onTap:a,ref:u,...n,draggable:r,onDragEnd:e=>{s({...n,x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{let t=u.current,r=t.scaleX(),i=t.scaleY();t.scaleX(1),t.scaleY(1),s({...n,x:t.x(),y:t.y(),width:Math.max(5,t.width()*r),height:Math.max(t.height()*i),rotation:t.rotation()})}}),r&&(0,i.jsx)(o.Ge,{ref:h,flipEnabled:!1,boundBoxFunc:(e,t)=>5>Math.abs(t.width)||5>Math.abs(t.height)?e:t})]})},b=()=>{let e=(0,l.useRef)(null),[t,n]=(0,l.useState)([]),[r,s]=(0,l.useState)(null),[c,u]=(0,l.useState)("#fff"),[h,g]=(0,l.useState)(!1),[f,x]=(0,l.useState)([]),[b,E]=(0,l.useState)([]),_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;n(e),u(t),x(n=>[...n,{images:m(e),color:t}]),E([])},S=async e=>{if(!e.target.files[0])return;let r=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),i=new window.Image;i.src=r,i.onload=()=>{let{width:e,height:l}=i,o=[...t,{url:r,id:Math.floor(9999*Math.random())+1,x:e/2/2,y:l/2/2,width:e,height:l,rotation:0}];n(o),_(o)}},L=e=>{e.target===e.target.getStage()&&(s(null),g(!1))},R=()=>{if(f.length<=1)return;let e=f[f.length-2],t=f[f.length-1];n(e.images),u(e.color),x(e=>e.slice(0,-1)),E(e=>[...e,t]),s(null)},M=()=>{if(0===b.length)return;let e=b[b.length-1];n(e.images),u(e.color),x(t=>[...t,e]),E(e=>e.slice(0,-1))};return(0,l.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),R()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),M())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,b]),(0,l.useEffect)(()=>{0===f.length&&x([{images:[],color:"#fff"}])},[]),(0,l.useEffect)(()=>{var t;let n=null===(t=e.current)||void 0===t?void 0:t.container();n&&(n.style.backgroundColor=c)},[c]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.BI,{width:w,height:p,ref:e,onMouseDown:L,onTouchStart:L,children:(0,i.jsx)(o.Wd,{children:t.map((e,n)=>(0,i.jsx)(j,{src:e.url,shapeProps:e,isSelected:e.id===r,onSelect:()=>{s(e.id)},onChange:e=>{let r=t.slice();r[n]=e,_(r),console.log("rects",r)}},n))})}),h&&(0,i.jsx)(v,{children:(0,i.jsx)(a.Xq,{color:c,onChange:n=>{e.current.container().style.backgroundColor=n.hex,_(t,n.hex)}})}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsxs)(y,{children:[(0,i.jsx)("button",{onClick:()=>g(!h),title:"배경색 선택",children:(0,i.jsx)(d.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,i.jsxs)(C,{title:"이미지 추가",children:[(0,i.jsx)(k,{type:"file",id:"file_input",onChange:S}),(0,i.jsx)(d.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,i.jsxs)(C,{title:"이미지 추가",children:[(0,i.jsx)(k,{type:"file",id:"file_input",onChange:S}),(0,i.jsx)(d.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,i.jsx)("button",{onClick:R,title:"되돌리기 (Ctrl+Z)",children:(0,i.jsx)(d.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,i.jsx)("button",{onClick:M,title:"다시 실행 (Ctrl+Y)",children:(0,i.jsx)(d.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})}),(0,i.jsx)("button",{onClick:()=>{let t=e.current;if(!t)return;let n=t.find("Transformer");n.forEach(e=>e.hide()),t.draw();let r=t.toDataURL({pixelRatio:2}),i=document.createElement("a");i.download="canvas-export.png",i.href=r,i.click(),n.forEach(e=>e.show()),t.draw()},title:"이미지 저장",children:(0,i.jsx)(d.default,{src:"./images/save.png",width:25,height:25,alt:"redo-icon"})}),r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{title:"인덱스 하나 앞으로 이동",onClick:()=>{let e=t.findIndex(e=>e.id===r);if(-1===e||e===t.length-1)return;let n=[...t];[n[e],n[e+1]]=[n[e+1],n[e]],_(n)},children:(0,i.jsx)(d.default,{src:"./images/foward.png",width:25,height:25,alt:"redo-icon"})}),(0,i.jsx)("button",{title:"인덱스 하나 뒤로 이동",onClick:()=>{let e=t.findIndex(e=>e.id===r);if(e<=0)return;let n=[...t];[n[e-1],n[e]]=[n[e],n[e-1]],_(n)},style:{marginLeft:10},children:(0,i.jsx)(d.default,{src:"./images/backward.png",width:25,height:25,alt:"redo-icon"})})]})]})})]})},y=u.Ay.div(h()),k=u.Ay.input(g()),C=u.Ay.label(f()),v=u.Ay.div(x())}}]);