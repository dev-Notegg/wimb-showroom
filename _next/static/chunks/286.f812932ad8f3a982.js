(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{84286:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var i=r(95155),n=r(13199),h=r(12115),a=r(20450),d=r.n(a);let u=[{x:60,y:60,width:100,height:90,fill:"red",id:"rect1",name:"rect"},{x:250,y:100,width:150,height:90,fill:"green",id:"rect2",name:"rect"}],s=()=>{let[e,t]=(0,h.useState)(u),[r,a]=(0,h.useState)([]),[s,l]=(0,h.useState)({visible:!1,x1:0,y1:0,x2:0,y2:0}),[o,c]=(0,h.useState)([]);(0,h.useRef)(!1);let g=(0,h.useRef)(),x=(0,h.useRef)(new Map),f=(0,h.useRef)(),w=r=>{let i=r.target.id(),n=e.findIndex(e=>e.id===i);if(-1!==n){let i=[...e];i[n]={...i[n],x:r.target.x(),y:r.target.y()},t(i)}},y=e=>{let{src:t,...r}=e;console.log("src",r);let[h]=d()(t,"anonymous");return(0,i.jsx)(n._V,{image:h,...r})},m=e=>{let t=1/0,r=1/0,i=-1/0,n=-1/0;return e.forEach(e=>{t=Math.min(t,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x+e.width),n=Math.max(n,e.y+e.height)}),{x:t,y:r,width:i-t,height:n-r}},[v,M]=(0,h.useState)({width:window.innerWidth,height:window.innerHeight}),R=()=>{let e=[{id:"images"}].map(e=>x.current.get(e.id));g.current.nodes(e)},p=(e,t,r,i,n)=>{let h=Math.sqrt(r*r+i*i);return{x:e+h*Math.cos(n+=Math.atan2(i,r)),y:t+h*Math.sin(n)}},j=e=>{let{x:t,y:r,width:i,height:n}=e,h=e.rotation,a=p(t,r,0,0,h),d=p(t,r,i,0,h),u=p(t,r,i,n,h),s=p(t,r,0,n,h),l=Math.min(a.x,d.x,u.x,s.x),o=Math.min(a.y,d.y,u.y,s.y);return{x:l,y:o,width:Math.max(a.x,d.x,u.x,s.x)-l,height:Math.max(a.y,d.y,u.y,s.y)-o}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{children:"Render a local image without upload"}),(0,i.jsx)("div",{children:(0,i.jsx)("input",{type:"file",id:"file_input",onChange:e=>{var t=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]);console.log("e.target.files[0]",e.target.files[0]),console.log("url",t),c([{url:t,id:"images",x:0,y:0,width:500,height:500}])}})}),(0,i.jsx)("div",{id:"canvas-container"}),(0,i.jsx)(n.BI,{width:window.innerWidth,height:window.innerHeight,ref:f,children:(0,i.jsxs)(n.Wd,{children:[e.map(e=>(0,i.jsx)(n.rw,{id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,fill:e.fill,name:e.name,draggable:!0,ref:t=>{t&&x.current.set(e.id,t)},onDragEnd:w},e.id)),o.map(e=>(0,i.jsx)(y,{src:e.url,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,draggable:!0,onTouchstart:R,ref:t=>{t&&x.current.set(e.id,t)}},"url")),(0,i.jsx)(n.Ge,{ref:g,boundBoxFunc:(e,t)=>{let r=j(t);return r.x<0||r.y<0||r.x+r.width>v.width||r.y+r.height>v.height?e:t},onDragMove:e=>{if(!g.current)return;let t=g.current.nodes();if(0===t.length)return;let r=m(t.map(e=>e.getClientRect()));t.forEach(e=>{let t=e.getAbsolutePosition(),i=r.x-t.x,n=r.y-t.y,h={...t};r.x<0&&(h.x=-i),r.y<0&&(h.y=-n),r.x+r.width>v.width&&(h.x=v.width-r.width-i),r.y+r.height>v.height&&(h.y=v.height-r.height-n),e.setAbsolutePosition(h)})}})]})})]})}},20450:(e,t,r)=>{var i=r(12115);e.exports=function(e,t,r){let n=i.useRef("loading"),h=i.useRef(),[a,d]=i.useState(0),u=i.useRef(),s=i.useRef(),l=i.useRef();return(u.current!==e||s.current!==t||l.current!==r)&&(n.current="loading",h.current=void 0,u.current=e,s.current=t,l.current=r),i.useLayoutEffect(function(){if(e){var i=document.createElement("img");return i.addEventListener("load",a),i.addEventListener("error",u),t&&(i.crossOrigin=t),r&&(i.referrerPolicy=r),i.src=e,function(){i.removeEventListener("load",a),i.removeEventListener("error",u)}}function a(){n.current="loaded",h.current=i,d(Math.random())}function u(){n.current="failed",h.current=void 0,d(Math.random())}},[e,t,r]),[h.current,n.current]}}}]);