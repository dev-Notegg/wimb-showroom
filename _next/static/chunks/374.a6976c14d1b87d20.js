"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{17374:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var r=n(95155),i=n(12115),o=n(13199),l=n(37903);n(20450);var s=n(5565);n(82537);var a=n(20698),d=n(65285);function u(){let e=(0,a._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n\n  img {\n    width: 25px;\n  }\n"]);return u=function(){return e},e}function c(){let e=(0,a._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return c=function(){return e},e}function h(){let e=(0,a._)(["\n  cursor: pointer;\n"]);return h=function(){return e},e}function g(){let e=(0,a._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return g=function(){return e},e}let f=d.Ay.div(u()),p=d.Ay.input(c()),x=d.Ay.label(h());d.Ay.div(g());let m=e=>{let t;let n=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>l,subscribe:e=>(n.add(e),()=>n.delete(e))},l=t=e(r,i,o);return o},w=e=>e?m(e):m,y=e=>e,j=e=>{let t=w(e),n=e=>(function(e,t=y){let n=i.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return i.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},b=e=>e?j(e):j,k=b((e,t)=>({width:window.innerWidth,height:window.innerHeight,stageRef:null}));function S(e){let{children:t}=e,{width:n,height:l,color:s,stageRef:a}=k();return(0,i.useEffect)(()=>{var e;let t=null==a?void 0:null===(e=a.current)||void 0===e?void 0:e.container();t&&(t.style.backgroundColor=s)},[s]),(0,r.jsx)(o.BI,{width:n,height:l,ref:a,children:t})}let v=b((e,t)=>({color:"#fff",images:[],history:[],redoStack:[],undoRedoState:0,setImages:e=>{t({images:e})},setColor:e=>{t({color:e})},setUndoRedoState:()=>{t({undoRedoState:e().undoRedoState+1})},setRedoStack:e=>{t({redoStack:e})},applyHistory:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:color,{setImages:r,setColor:i,history:o,setHistory:l,setRedoStack:s,setUndoRedoState:a}=e();r(t),i(n),l(e=>[...o,{images:deepClone(t),color:n}]),s([])},undo:()=>{let{history:t,setImages:n,setColor:r,setHistory:i,setRedoStack:o,setUndoRedoState:l}=e();if(console.log("history",t),t.length<=1)return;let s=t[t.length-2],a=t[t.length-1];n(s.images),r(s.color),i(e=>e.slice(0,-1)),o([...e().prevList,a]),l()},redo:()=>{let{redoStack:t,setImages:n,setColor:r,setHistory:i,setRedoStack:o,setUndoRedoState:l}=e();if(0===t.length)return;let s=e().redoStack[t.length-1];n(s.images),r(s.color),i(e=>[...e,s]),o(e=>e.slice(0,-1)),l()},handleChangeComplete:t=>{let{applyHistory:n}=e(),{stageRef:r}=k.getState();r.container().style.backgroundColor=t.hex,n(images,t.hex)},fileInputOnChange:async t=>{if(!t.target.files[0])return;let{images:n,setImages:r,applyHistory:i}=e(),{stageRef:o}=k.getState(),l=(window.webkitURL||window.URL).createObjectURL(t.target.files[0]),s=new window.Image;s.src=l,s.onload=()=>{let{width:e,height:t}=s;var a=o.current.getWidth()-2,d=o.current.getHeight()-2,u=a/e,c=d/t,h=u>c?c:u,g=parseInt(e*h,10),f=parseInt(t*h,10);let p=[...n,{url:l,id:Math.floor(9999*Math.random())+1,x:o.current.width()/4,y:o.current.height()/4,width:g,height:f,offsetX:o.current.width()/2,offsetY:o.current.height()/2,scale:{x:1,y:1},rotation:0}];r(p),i(p)}}})),C=e=>{let{src:t,shapeProps:n,onChange:i,onDragMove:o,onDragEnd:l,undoRedoState:s}=e,[a]=useImage(t,"anonymous"),d=useRef(),[u,c]=useSpring(()=>({width:n.width,height:n.height,x:n.width/2,y:n.height/2,offsetX:n.width/2,offsetY:n.height/2}));return useGesture({onDrag:e=>{let{pinching:t,cancel:n,offset:[r,i]}=e;if(t)return n();c.start({x:r,y:i,immediate:!0}),o("",d.current)},onPinch:e=>{let{offset:[t,n]}=e;c.start({scale:{x:t,y:t},rotation:n})},onPinchEnd:e=>{let{offset:[t,r]}=e;i({...n,scale:{x:t,y:t},rotation:r})},onDragEnd:e=>{let{offset:[t,r]}=e;i({...n,x:u.x.get(),y:u.y.get()}),l&&l()}},{drag:{pointer:{capture:!1,touch:!0},from:()=>[u.x.get(),u.y.get()]},pinch:{pointer:{touch:!0,capture:!1}},target:d}),useEffect(()=>{s&&n&&c.start({width:n.width,height:n.height,x:n.x,y:n.y,offsetX:n.offsetX,offsetY:n.offsetY,scale:n.scale,rotation:n.rotation,immediate:!0})},[s]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(animated.Image,{name:"object",image:a,ref:d,...u})})};function E(e){let{children:t,ref:n}=e,{images:i,setImages:l,undoRedoState:s}=v();return(0,r.jsxs)(o._V,{children:[i.map((e,t)=>(0,r.jsx)(C,{src:e.url,shapeProps:e,undoRedoState:s,onChange:e=>{let n=i.slice();n[t]=e,applyHistory(n)},onDragMove:handleDragMove,onDragEnd:handleDragEnd},t)),t]})}let R=e=>e.map(e=>({...e})),I=()=>{let e=(0,i.useRef)(null),[t,n]=(0,i.useState)(null),[a,d]=(0,i.useState)(!1),[u,c]=(0,i.useState)([]),[h,g]=(0,i.useState)([]),[m,w]=(0,i.useState)(0),[y,j]=(0,i.useState)([]),{color:b,setColor:C}=k(),{fileInputOnChange:I,undo:_,redo:D}=v(),L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;setImages(e),C(t),c(n=>[...n,{images:R(e),color:t}]),g([])};return(0,i.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),_()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),D())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u,h]),(0,i.useEffect)(()=>{0===u.length&&c([{images:[],color:"#fff"}])},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(S,{ref:e,children:[(0,r.jsx)(o.Wd,{children:(0,r.jsx)(E,{})}),(0,r.jsx)(o.Wd,{children:y.map((e,t)=>"H"===e.orientation?(0,r.jsx)(o.N1,{points:[-6e3,e.lineGuide,6e3,e.lineGuide],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):"V"===e.orientation?(0,r.jsx)(o.N1,{points:[e.lineGuide,-6e3,e.lineGuide,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):null)})]}),a&&(0,r.jsx)(ColorPickerContainer,{children:(0,r.jsx)(l.Xq,{color:b,onChange:t=>{e.current.container().style.backgroundColor=t.hex,L(images,t.hex)}})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(f,{children:[(0,r.jsx)("button",{onClick:()=>d(!a),title:"배경색 선택",children:(0,r.jsx)(s.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,r.jsxs)(x,{title:"이미지 추가",children:[(0,r.jsx)(p,{type:"file",id:"file_input",onChange:I}),(0,r.jsx)(s.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,r.jsxs)(x,{title:"이미지 추가",children:[(0,r.jsx)(p,{type:"file",id:"file_input",onChange:I}),(0,r.jsx)(s.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,r.jsx)("button",{onClick:_,title:"되돌리기 (Ctrl+Z)",children:(0,r.jsx)(s.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,r.jsx)("button",{onClick:D,title:"다시 실행 (Ctrl+Y)",children:(0,r.jsx)(s.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})})]})})]})}}}]);