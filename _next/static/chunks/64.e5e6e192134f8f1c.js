"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{7064:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var r=n(20698),o=n(95155),i=n(12115),l=n(13199),a=n(37903),s=n(20450),u=n.n(s),c=n(5565),d=n(65285),h=n(93635),f=n(82537);window.Konva.hitOnDragEnabled=!0,window.Konva.captureTouchEventsEnabled=!0;let g=()=>{let[e,t]=(0,f.zh)(()=>({x:0,y:0,width:100,height:100,scale:{x:1,y:1},rotation:0,offsetX:50,offsetY:50})),n=i.useRef(null);return(0,h.useGesture)({onDrag:e=>{t.start({x:e.offset[0],y:e.offset[1]})},onPinch:e=>{t.start({scale:{x:e.offset[0],y:e.offset[0]},rotation:e.offset[1]})}},{drag:{pointer:{capture:!1,touch:!0}},pinch:{pointer:{touch:!0,capture:!1},scaleBounds:{min:.5,max:2},rubberband:!0},target:n}),(0,o.jsx)(f.CS.Rect,{ref:n,...e,fill:"red",width:200,height:200})};function p(){let e=(0,r._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n"]);return p=function(){return e},e}function x(){let e=(0,r._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return x=function(){return e},e}function w(){let e=(0,r._)(["\n  cursor: pointer;\n"]);return w=function(){return e},e}function m(){let e=(0,r._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return m=function(){return e},e}let y=window.innerWidth,b=window.innerHeight;window.Konva.hitOnDragEnabled=!0,window.Konva.captureTouchEventsEnabled=!0;let j=e=>e.map(e=>({...e})),v=e=>{let{src:t,shapeProps:n,isSelected:r,onSelect:l,onChange:a}=e,[s]=u()(t,"anonymous"),c=(0,i.useRef)();(0,i.useRef)(),console.log("shpeProps",n);let[d,g]=(0,f.zh)(()=>({x:0,y:0,width:100,height:100,scale:{x:1,y:1},rotation:0,offsetX:50,offsetY:50})),p=(0,i.useRef)(null);return(0,h.useGesture)({onDrag:e=>{g.start({x:e.offset[0],y:e.offset[1]})},onPinch:e=>{g.start({scale:{x:e.offset[0],y:e.offset[0]},rotation:e.offset[1]})}},{drag:{pointer:{capture:!1,touch:!0}},pinch:{pointer:{touch:!0,capture:!1},rubberband:!0},target:p}),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.CS.Image,{image:s,ref:p,...d,width:n.width,height:n.height,onDragEnd:e=>{a({...n,x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{let t=c.current,r=t.scaleX(),o=t.scaleY();t.scaleX(1),t.scaleY(1),a({...n,x:t.x(),y:t.y(),width:Math.max(5,t.width()*r),height:Math.max(t.height()*o),rotation:t.rotation()})}})})},k=()=>{let e=(0,i.useRef)(null),[t,n]=(0,i.useState)([]),[r,s]=(0,i.useState)(null),[u,d]=(0,i.useState)("#fff"),[h,f]=(0,i.useState)(!1),[p,x]=(0,i.useState)([]),[w,m]=(0,i.useState)([]),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;n(e),d(t),x(n=>[...n,{images:j(e),color:t}]),m([])},R=async e=>{if(!e.target.files[0])return;let r=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),o=new window.Image;o.src=r,o.onload=()=>{let{width:e,height:i}=o,l=[...t,{url:r,id:Math.floor(9999*Math.random())+1,x:e/2/2,y:i/2/2,width:e,height:i}];n(l),k(l)}},D=e=>{e.target===e.target.getStage()&&(s(null),f(!1))},K=()=>{if(p.length<=1)return;let e=p[p.length-2],t=p[p.length-1];n(e.images),d(e.color),x(e=>e.slice(0,-1)),m(e=>[...e,t]),s(null)},L=()=>{if(0===w.length)return;let e=w[w.length-1];n(e.images),d(e.color),x(t=>[...t,e]),m(e=>e.slice(0,-1))};return(0,i.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),K()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),L())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p,w]),(0,i.useEffect)(()=>{0===p.length&&x([{images:[],color:"#fff"}])},[]),(0,i.useEffect)(()=>{var t;let n=null===(t=e.current)||void 0===t?void 0:t.container();n&&(n.style.backgroundColor=u)},[u]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.BI,{width:y,height:b,ref:e,onMouseDown:D,onTouchStart:D,children:(0,o.jsxs)(l.Wd,{children:[(0,o.jsx)(g,{}),t.map((e,n)=>(0,o.jsx)(v,{src:e.url,shapeProps:e,isSelected:e.id===r,onSelect:()=>{s(e.id)},onChange:e=>{let r=t.slice();r[n]=e,k(r),console.log("rects",r)}},n))]})}),h&&(0,o.jsx)(_,{children:(0,o.jsx)(a.Xq,{color:u,onChange:n=>{e.current.container().style.backgroundColor=n.hex,k(t,n.hex)}})}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)(C,{children:[(0,o.jsx)("button",{onClick:()=>f(!h),title:"배경색 선택",children:(0,o.jsx)(c.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,o.jsxs)(S,{title:"이미지 추가",children:[(0,o.jsx)(E,{type:"file",id:"file_input",onChange:R}),(0,o.jsx)(c.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,o.jsxs)(S,{title:"이미지 추가",children:[(0,o.jsx)(E,{type:"file",id:"file_input",onChange:R}),(0,o.jsx)(c.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,o.jsx)("button",{onClick:K,title:"되돌리기 (Ctrl+Z)",children:(0,o.jsx)(c.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,o.jsx)("button",{onClick:L,title:"다시 실행 (Ctrl+Y)",children:(0,o.jsx)(c.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})})]})})]})},C=d.Ay.div(p()),E=d.Ay.input(x()),S=d.Ay.label(w()),_=d.Ay.div(m())}}]);