"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[488],{74488:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var l=n(95155),r=n(12115),i=n(13199),o=n(37903),s=n(20450),a=n.n(s);let d=window.innerWidth,c=window.innerHeight,u=e=>e.map(e=>({...e})),h={padding:"8px 16px",fontSize:"14px",backgroundColor:"#f0f0f0",border:"1px solid #ccc",borderRadius:"4px",marginRight:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},g=e=>{let{src:t,shapeProps:n,isSelected:o,onSelect:s,onChange:d}=e,[c]=a()(t,"anonymous"),u=(0,r.useRef)(),h=(0,r.useRef)();return(0,r.useEffect)(()=>{o&&h.current.nodes([u.current])},[o]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i._V,{image:c,onClick:s,onTap:s,ref:u,...n,draggable:o,onDragEnd:e=>{d({...n,x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{let t=u.current,l=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),d({...n,x:t.x(),y:t.y(),width:Math.max(5,t.width()*l),height:Math.max(t.height()*r),rotation:t.rotation()})}}),o&&(0,l.jsx)(i.Ge,{ref:h,flipEnabled:!1,boundBoxFunc:(e,t)=>5>Math.abs(t.width)||5>Math.abs(t.height)?e:t})]})},f=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),[f,x]=(0,r.useState)("#fff"),[p,w]=(0,r.useState)([]),[y,m]=(0,r.useState)([]),b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;n(e),x(t),w(n=>[...n,{images:u(e),color:t}]),m([])},j=async e=>{let l=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),r=new window.Image;r.src=l,r.onload=()=>{let{width:e,height:i}=r,o=[...t,{url:l,id:Math.floor(9999*Math.random())+1,x:e/2/2,y:i/2/2,width:e,height:i,rotation:0}];n(o),b(o)}},k=e=>{e.target===e.target.getStage()&&a(null)},v=()=>{if(p.length<=1)return;let e=p[p.length-2],t=p[p.length-1];n(e.images),x(e.color),w(e=>e.slice(0,-1)),m(e=>[...e,t]),a(null)},C=()=>{if(0===y.length)return;let e=y[y.length-1];n(e.images),x(e.color),w(t=>[...t,e]),m(e=>e.slice(0,-1))};return(0,r.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),v()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),C())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p,y]),(0,r.useEffect)(()=>{0===p.length&&w([{images:[],color:"#fff"}])},[]),(0,r.useEffect)(()=>{var t;let n=null===(t=e.current)||void 0===t?void 0:t.container();n&&(n.style.backgroundColor=f)},[f]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:{display:"flex",position:"absolute",zIndex:"999"},children:[(0,l.jsx)(o.Xq,{color:f,onChange:n=>{e.current.container().style.backgroundColor=n.hex,b(t,n.hex)}}),(0,l.jsxs)("div",{style:{marginLeft:20},children:[(0,l.jsx)("div",{children:"로컬에서 이미지 불러와 편집"}),(0,l.jsx)("div",{children:(0,l.jsx)("input",{type:"file",id:"file_input",onChange:j})}),(0,l.jsxs)("div",{style:{marginTop:10},children:[(0,l.jsx)("button",{onClick:v,style:h,title:"되돌리기 (Ctrl+Z)",children:"⬅️ Undo"}),(0,l.jsx)("button",{onClick:C,style:h,title:"다시 실행 (Ctrl+Y)",children:"➡️ Redo"})]})]})]}),(0,l.jsx)(i.BI,{width:d,height:c,ref:e,onMouseDown:k,onTouchStart:k,children:(0,l.jsx)(i.Wd,{children:t.map((e,n)=>(0,l.jsx)(g,{src:e.url,shapeProps:e,isSelected:e.id===s,onSelect:()=>{a(e.id)},onChange:e=>{let l=t.slice();l[n]=e,b(l),console.log("rects",l)}},n))})})]})}}}]);