"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{87942:(t,e,n)=>{n.r(e),n.d(e,{default:()=>k});var i=n(20698),r=n(95155),o=n(12115),a=n(13199),l=n(37903),s=n(20450),h=n.n(s),d=n(5565),u=n(65285),c=n(93635),f=n(82537);function g(){let t=(0,i._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n\n  img {\n    width: 25px;\n  }\n"]);return g=function(){return t},t}function x(){let t=(0,i._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return x=function(){return t},t}function p(){let t=(0,i._)(["\n  cursor: pointer;\n"]);return p=function(){return t},t}function w(){let t=(0,i._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return w=function(){return t},t}let y=window.innerWidth,m=window.innerHeight,b=t=>t.map(t=>({...t})),j=t=>{let{src:e,onSelect:n,shapeProps:i,onChange:l,onDragMove:s,onDragEnd:d,undoRedoState:u,isSelected:g}=t,[x]=h()(e,"anonymous"),p=(0,o.useRef)(),w=(0,o.useRef)(),[y,m]=(0,f.zh)(()=>({width:i.width,height:i.height,x:i.width/2,y:i.height/2}));return(0,c.useGesture)({onDrag:t=>{let{pinching:e,cancel:n,offset:[i,r]}=t;if(e)return n();m.start({x:i,y:r,immediate:!0}),s("",p.current)},onPinch:t=>{let{offset:[e,n]}=t;m.start({scale:{x:e,y:e},rotation:n})},onPinchEnd:t=>{let{offset:[e,n]}=t;l({...i,scale:{x:e,y:e},rotation:n})},onDragEnd:t=>{let{offset:[e,n]}=t;l({...i,x:y.x.get(),y:y.y.get()}),d&&d()}},{drag:{pointer:{capture:!1,touch:!0},from:()=>[y.x.get(),y.y.get()]},pinch:{pointer:{touch:!0,capture:!1}},target:p}),(0,o.useEffect)(()=>{u&&i&&m.start({width:i.width,height:i.height,x:i.x,y:i.y,offsetX:i.offsetX,offsetY:i.offsetY,scale:i.scale,rotation:i.rotation,immediate:!0})},[u]),(0,o.useEffect)(()=>{g&&w.current.nodes([p.current]),g&&w.current&&p.current&&(w.current.nodes([p.current]),w.current.getLayer().batchDraw())},[g]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.CS.Image,{name:"object",image:x,ref:p,onClick:n,onTap:n,...i,onDragEnd:t=>{l({...i,x:t.target.x(),y:t.target.y()})},onTransformEnd:t=>{let e=p.current,n=e.scaleX(),r=e.scaleY();e.scaleX(1),e.scaleY(1),l({...i,x:e.x(),y:e.y(),width:Math.max(5,e.width()*n),height:Math.max(e.height()*r),rotation:e.rotation()})}}),g&&(0,r.jsx)(a.Ge,{ref:w,flipEnabled:!1,boundBoxFunc:(t,e)=>5>Math.abs(e.width)||5>Math.abs(e.height)?t:e})]})},k=()=>{let t=(0,o.useRef)(null),e=(0,o.useRef)(null),[n,i]=(0,o.useState)([]),[s,h]=(0,o.useState)(null),[u,c]=(0,o.useState)("#fff"),[f,g]=(0,o.useState)(!1),[x,p]=(0,o.useState)([]),[w,k]=(0,o.useState)([]),[G,M]=(0,o.useState)(0),[R,D]=(0,o.useState)([]),[W,I]=(0,o.useState)(!1),[L,_]=(0,o.useState)(null),H=(0,o.useRef)(null),P=(0,o.useRef)(null),X=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;i(t),c(e),p(n=>[...n,{images:b(t),color:e}]),k([])},Y=async e=>{if(!e.target.files[0])return;let r=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),o=new window.Image;o.src=r,o.onload=()=>{let{width:e,height:a}=o;var l=t.current.getWidth()-2,s=t.current.getHeight()-2,h=l/e,d=s/a,u=h>d?d:h,c=parseInt(e*u,10),f=parseInt(a*u,10);let g=[...n,{url:r,id:Math.floor(9999*Math.random())+1,x:t.current.width()/4,y:t.current.height()/4,width:c,height:f,scale:{x:1,y:1},rotation:0,origWidth:o.naturalWidth,origHeight:o.naturalHeight,crop:{x:0,y:0,width:o.naturalWidth,height:o.naturalHeight}}];i(g),X(g)}},z=t=>{t.target===t.target.getStage()&&(h(null),g(!1))},F=()=>{if(x.length<=1)return;let t=x[x.length-2],e=x[x.length-1];i(t.images),c(t.color),p(t=>t.slice(0,-1)),k(t=>[...t,e]),h(null),M(t=>t+1),I(!1)},N=()=>{if(0===w.length)return;let t=w[w.length-1];i(t.images),c(t.color),p(e=>[...e,t]),k(t=>t.slice(0,-1)),M(t=>t+1),I(!1)};(0,o.useEffect)(()=>{let t=t=>{t.ctrlKey&&"z"===t.key?(t.preventDefault(),F()):t.ctrlKey&&"y"===t.key&&(t.preventDefault(),N())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[x,w]),(0,o.useEffect)(()=>{0===x.length&&p([{images:[],color:"#fff"}])},[]),(0,o.useEffect)(()=>{var e;let n=null===(e=t.current)||void 0===e?void 0:e.container();n&&(n.style.backgroundColor=u)},[u]),(0,o.useEffect)(()=>{P.current&&(P.current.rotateEnabled(!1),P.current.rotateLineVisible(!1))},[W]);let T=e=>{let n=t.current,i=[0,n.width()/2,n.width()],r=[0,n.height()/2,n.height()];return n.find(".object").forEach(t=>{if(t===e)return;let n=t.getClientRect({skipStroke:!0});i.push(n.x,n.x+n.width,n.x+n.width/2),r.push(n.y,n.y+n.height,n.y+n.height/2)}),{vertical:i,horizontal:r}},A=t=>{let e=t.getClientRect({skipStroke:!0}),n=t.absolutePosition();return{vertical:[{guide:e.x,offset:n.x-e.x,snap:"start"},{guide:e.x+e.width/2,offset:n.x-(e.x+e.width/2),snap:"center"},{guide:e.x+e.width,offset:n.x-(e.x+e.width),snap:"end"}],horizontal:[{guide:e.y,offset:n.y-e.y,snap:"start"},{guide:e.y+e.height/2,offset:n.y-(e.y+e.height/2),snap:"center"},{guide:e.y+e.height,offset:n.y-(e.y+e.height),snap:"end"}]}},U=(t,e)=>{let n=[],i=[];t.vertical.forEach(t=>{e.vertical.forEach(e=>{let i=Math.abs(t-e.guide);i<5&&n.push({lineGuide:t,diff:i,snap:e.snap,offset:e.offset})})}),t.horizontal.forEach(t=>{e.horizontal.forEach(e=>{let n=Math.abs(t-e.guide);n<5&&i.push({lineGuide:t,diff:n,snap:e.snap,offset:e.offset})})});let r=[],o=n.sort((t,e)=>t.diff-e.diff)[0],a=i.sort((t,e)=>t.diff-e.diff)[0];return o&&r.push({lineGuide:o.lineGuide,offset:o.offset,orientation:"V",snap:o.snap}),a&&r.push({lineGuide:a.lineGuide,offset:a.offset,orientation:"H",snap:a.snap}),r},V=(t,e)=>{D([]);let n=U(T(e),A(e));if(n.length){let t=e.absolutePosition();n.forEach(e=>{switch(e.orientation){case"V":t.x=e.lineGuide+e.offset;break;case"H":t.y=e.lineGuide+e.offset}}),e.absolutePosition(t)}D(n)},q=()=>{D([])};return(0,o.useEffect)(()=>{W&&H.current&&P.current&&(P.current.nodes([H.current]),P.current.getLayer().batchDraw())},[W,L]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.BI,{width:y,height:m,ref:t,onMouseDown:z,onTouchStart:z,children:[(0,r.jsx)(a.Wd,{ref:e,children:n.map((t,e)=>(0,r.jsx)(j,{src:t.url,shapeProps:t,undoRedoState:G,isSelected:t.id===s,onSelect:()=>{h(t.id)},onChange:t=>{let i=n.slice();i[e]=t,X(i)},onDragMove:V,onDragEnd:q},e))}),(0,r.jsx)(a.Wd,{children:R.map((t,e)=>"H"===t.orientation?(0,r.jsx)(a.N1,{points:[-6e3,t.lineGuide,6e3,t.lineGuide],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},e):"V"===t.orientation?(0,r.jsx)(a.N1,{points:[t.lineGuide,-6e3,t.lineGuide,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},e):null)}),W&&L&&(0,r.jsxs)(a.Wd,{children:[(0,r.jsx)(a.rw,{x:L.x,y:L.y,width:L.width,height:L.height,rotation:L.rotation,stroke:"red",dash:[4,4],draggable:!0,onDragEnd:t=>{_({...L,x:t.target.x(),y:t.target.y()})},onTransformEnd:t=>{let e=t.target,n=e.scaleX(),i=e.scaleY();_({x:e.x(),y:e.y(),width:Math.max(5,e.width()*n),height:Math.max(5,e.height()*i),rotation:e.rotation()}),e.scaleX(1),e.scaleY(1)},ref:H}),(0,r.jsx)(a.Ge,{ref:P})]})]}),f&&(0,r.jsx)(S,{children:(0,r.jsx)(l.Xq,{color:u,onChange:e=>{t.current.container().style.backgroundColor=e.hex,X(n,e.hex)}})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(E,{children:[(0,r.jsx)("button",{onClick:()=>g(!f),title:"배경색 선택",children:(0,r.jsx)(d.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,r.jsxs)(v,{title:"이미지 추가",children:[(0,r.jsx)(C,{type:"file",id:"file_input",onChange:Y}),(0,r.jsx)(d.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,r.jsxs)(v,{title:"이미지 추가",children:[(0,r.jsx)(C,{type:"file",id:"file_input",onChange:Y}),(0,r.jsx)(d.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,r.jsx)("button",{onClick:F,title:"되돌리기 (Ctrl+Z)",children:(0,r.jsx)(d.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,r.jsx)("button",{onClick:N,title:"다시 실행 (Ctrl+Y)",children:(0,r.jsx)(d.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})}),(0,r.jsx)("button",{onClick:()=>{let e=t.current;if(!e)return;let n=e.find("Transformer");n.forEach(t=>t.hide()),e.draw();let i=e.toDataURL({pixelRatio:2}),r=document.createElement("a");r.download="canvas-export.png",r.href=i,r.click(),n.forEach(t=>t.show()),e.draw()},title:"이미지 저장",children:(0,r.jsx)(d.default,{src:"./images/save.png",width:25,height:25,alt:"redo-icon"})}),s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{title:"인덱스 하나 앞으로 이동",onClick:()=>{let t=n.findIndex(t=>t.id===s);if(-1===t||t===n.length-1)return;let e=[...n];[e[t],e[t+1]]=[e[t+1],e[t]],X(e),M(t=>t+1)},children:(0,r.jsx)(d.default,{src:"./images/foward.png",width:25,height:25,alt:"redo-icon"})}),(0,r.jsx)("button",{title:"인덱스 하나 뒤로 이동",onClick:()=>{let t=n.findIndex(t=>t.id===s);if(t<=0)return;let e=[...n];[e[t-1],e[t]]=[e[t],e[t-1]],X(e),M(t=>t+1)},style:{marginLeft:10},children:(0,r.jsx)(d.default,{src:"./images/backward.png",width:25,height:25,alt:"redo-icon"})})]}),!W&&s&&(0,r.jsx)("button",{onClick:()=>{if(!s)return;let t=n.findIndex(t=>t.id===s);if(-1===t)return;let e=n[t];_({x:e.x,y:e.y,width:e.width,height:e.height,rotation:e.rotation}),I(!0)},title:"크롭 모드",children:"Crop"}),W&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{if(!s||!L)return;let t=n.findIndex(t=>t.id===s);if(-1===t)return;let e=n[t],r=e.rotation*Math.PI/180,o=L.x-e.x,a=L.y-e.y,l=Math.cos(-r),d=Math.sin(-r),u=e.crop?e.crop:{x:0,y:0,width:e.origWidth,height:e.origHeight},c=u.width/e.width,f=u.height/e.height,g={x:u.x+(o*l-a*d)*c,y:u.y+(o*d+a*l)*f,width:L.width*c,height:L.height*f},x={...e,x:L.x,y:L.y,width:L.width,height:L.height,crop:g},p=[...n];p[t]=x,i(p),X(p),I(!1),_(null),h(null),M(t=>t+1)},title:"크롭 적용",children:"Confirm Crop"}),(0,r.jsx)("button",{onClick:()=>{I(!1),_(null)},title:"크롭 취소",children:"Cancel Crop"})]})]})})]})},E=u.Ay.div(g()),C=u.Ay.input(x()),v=u.Ay.label(p()),S=u.Ay.div(w())}}]);