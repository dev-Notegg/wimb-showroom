"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{68421:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var i=n(20698),r=n(95155),o=n(12115),s=n(13199),a=n(37903),l=n(20450),h=n.n(l),u=n(5565),f=n(65285),d=n(93635),c=n(82537);function g(){let e=(0,i._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n\n  img {\n    width: 25px;\n  }\n"]);return g=function(){return e},e}function p(){let e=(0,i._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return p=function(){return e},e}function x(){let e=(0,i._)(["\n  cursor: pointer;\n"]);return x=function(){return e},e}function w(){let e=(0,i._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return w=function(){return e},e}let y=window.innerWidth,m=window.innerHeight,b=e=>e.map(e=>({...e})),j=e=>{let{src:t,shapeProps:n,onChange:i,onDragMove:s,onDragEnd:a,undoRedoState:l}=e,[u]=h()(t,"anonymous"),f=(0,o.useRef)(),[g,p]=(0,c.zh)(()=>({width:n.width,height:n.height,x:n.width/2,y:n.height/2,offsetX:n.width/2,offsetY:n.height/2}));return(0,d.useGesture)({onDrag:e=>{let{pinching:t,cancel:n,offset:[i,r]}=e;if(t)return n();p.start({x:i,y:r,immediate:!0}),s("",f.current)},onPinch:e=>{let{offset:[t,n]}=e;p.start({scale:{x:t,y:t},rotation:n})},onPinchEnd:e=>{let{offset:[t,r]}=e;i({...n,scale:{x:t,y:t},rotation:r})},onDragEnd:e=>{let{offset:[t,r]}=e;i({...n,x:g.x.get(),y:g.y.get()}),a&&a()}},{drag:{pointer:{capture:!1,touch:!0},from:()=>[g.x.get(),g.y.get()]},pinch:{pointer:{touch:!0,capture:!1}},target:f}),(0,o.useEffect)(()=>{l&&n&&p.start({width:n.width,height:n.height,x:n.x,y:n.y,offsetX:n.offsetX,offsetY:n.offsetY,scale:n.scale,rotation:n.rotation,immediate:!0})},[l]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(c.CS.Image,{name:"object",image:u,ref:f,...g})})},k=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),[n,i]=(0,o.useState)([]),[l,h]=(0,o.useState)(null),[f,d]=(0,o.useState)("#fff"),[c,g]=(0,o.useState)(!1),[p,x]=(0,o.useState)([]),[w,k]=(0,o.useState)([]),[G,_]=(0,o.useState)(0),[R,D]=(0,o.useState)([]),z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;i(e),d(t),x(n=>[...n,{images:b(e),color:t}]),k([])},M=async t=>{if(!t.target.files[0])return;let r=(window.webkitURL||window.URL).createObjectURL(t.target.files[0]),o=new window.Image;o.src=r,o.onload=()=>{let{width:t,height:s}=o;var a=e.current.getWidth()-2,l=e.current.getHeight()-2,h=a/t,u=l/s,f=h>u?u:h,d=parseInt(t*f,10),c=parseInt(s*f,10);let g=[...n,{url:r,id:Math.floor(9999*Math.random())+1,x:e.current.width()/4,y:e.current.height()/4,width:d,height:c,offsetX:e.current.width()/2,offsetY:e.current.height()/2,scale:{x:1,y:1},rotation:0}];i(g),z(g)}},P=e=>{e.target===e.target.getStage()&&(h(null),g(!1))},W=()=>{if(p.length<=1)return;let e=p[p.length-2],t=p[p.length-1];i(e.images),d(e.color),x(e=>e.slice(0,-1)),k(e=>[...e,t]),h(null),_(e=>e+1)},H=()=>{if(0===w.length)return;let e=w[w.length-1];i(e.images),d(e.color),x(t=>[...t,e]),k(e=>e.slice(0,-1)),_(e=>e+1)};(0,o.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),W()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),H())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[p,w]),(0,o.useEffect)(()=>{0===p.length&&x([{images:[],color:"#fff"}])},[]),(0,o.useEffect)(()=>{var t;let n=null===(t=e.current)||void 0===t?void 0:t.container();n&&(n.style.backgroundColor=f)},[f]);let I=t=>{let n=e.current,i=[0,n.width()/2,n.width()],r=[0,n.height()/2,n.height()];return n.find(".object").forEach(e=>{if(e===t)return;let n=e.getClientRect({skipStroke:!0});i.push(n.x,n.x+n.width,n.x+n.width/2),r.push(n.y,n.y+n.height,n.y+n.height/2)}),{vertical:i,horizontal:r}},L=e=>{let t=e.getClientRect({skipStroke:!0}),n=e.absolutePosition();return{vertical:[{guide:t.x,offset:n.x-t.x,snap:"start"},{guide:t.x+t.width/2,offset:n.x-(t.x+t.width/2),snap:"center"},{guide:t.x+t.width,offset:n.x-(t.x+t.width),snap:"end"}],horizontal:[{guide:t.y,offset:n.y-t.y,snap:"start"},{guide:t.y+t.height/2,offset:n.y-(t.y+t.height/2),snap:"center"},{guide:t.y+t.height,offset:n.y-(t.y+t.height),snap:"end"}]}},N=(e,t)=>{let n=[],i=[];e.vertical.forEach(e=>{t.vertical.forEach(t=>{let i=Math.abs(e-t.guide);i<5&&n.push({lineGuide:e,diff:i,snap:t.snap,offset:t.offset})})}),e.horizontal.forEach(e=>{t.horizontal.forEach(t=>{let n=Math.abs(e-t.guide);n<5&&i.push({lineGuide:e,diff:n,snap:t.snap,offset:t.offset})})});let r=[],o=n.sort((e,t)=>e.diff-t.diff)[0],s=i.sort((e,t)=>e.diff-t.diff)[0];return o&&r.push({lineGuide:o.lineGuide,offset:o.offset,orientation:"V",snap:o.snap}),s&&r.push({lineGuide:s.lineGuide,offset:s.offset,orientation:"H",snap:s.snap}),r},X=(e,t)=>{D([]);let n=N(I(t),L(t));if(n.length){let e=t.absolutePosition();n.forEach(t=>{switch(t.orientation){case"V":e.x=t.lineGuide+t.offset;break;case"H":e.y=t.lineGuide+t.offset}}),t.absolutePosition(e)}D(n)},Y=()=>{D([])};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.BI,{width:y,height:m,ref:e,onMouseDown:P,onTouchStart:P,children:[(0,r.jsx)(s.Wd,{ref:t,children:n.map((e,t)=>(0,r.jsx)(j,{src:e.url,shapeProps:e,undoRedoState:G,onChange:e=>{let i=n.slice();i[t]=e,z(i)},onDragMove:X,onDragEnd:Y},t))}),(0,r.jsx)(s.Wd,{children:R.map((e,t)=>"H"===e.orientation?(0,r.jsx)(s.N1,{points:[-6e3,e.lineGuide,6e3,e.lineGuide],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):"V"===e.orientation?(0,r.jsx)(s.N1,{points:[e.lineGuide,-6e3,e.lineGuide,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):null)})]}),c&&(0,r.jsx)(S,{children:(0,r.jsx)(a.Xq,{color:f,onChange:t=>{e.current.container().style.backgroundColor=t.hex,z(n,t.hex)}})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(v,{children:[(0,r.jsx)("button",{onClick:()=>g(!c),title:"배경색 선택",children:(0,r.jsx)(u.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,r.jsxs)(C,{title:"이미지 추가",children:[(0,r.jsx)(E,{type:"file",id:"file_input",onChange:M}),(0,r.jsx)(u.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,r.jsxs)(C,{title:"이미지 추가",children:[(0,r.jsx)(E,{type:"file",id:"file_input",onChange:M}),(0,r.jsx)(u.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,r.jsx)("button",{onClick:W,title:"되돌리기 (Ctrl+Z)",children:(0,r.jsx)(u.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,r.jsx)("button",{onClick:H,title:"다시 실행 (Ctrl+Y)",children:(0,r.jsx)(u.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})})]})})]})},v=f.Ay.div(g()),E=f.Ay.input(p()),C=f.Ay.label(x()),S=f.Ay.div(w())}}]);