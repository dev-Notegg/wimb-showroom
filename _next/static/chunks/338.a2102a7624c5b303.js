"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{34338:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var i=n(20698),r=n(95155),o=n(12115),a=n(13199),l=n(37903),s=n(20450),h=n.n(s),d=n(5565),u=n(65285);function c(){let e=(0,i._)(["\n  position: absolute;\n\n  display: flex;\n  column-gap: 24px;\n\n  left: 50%;\n  bottom: 0;\n  transform: translate(-50%, -50%);\n\n  padding: 14px 31px;\n  border-radius: 80px;\n  background-color: rgba(0, 0, 0, 0.5);\n"]);return c=function(){return e},e}function f(){let e=(0,i._)(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  padding: 0;\n  overflow: hidden;\n  border: 0;\n"]);return f=function(){return e},e}function g(){let e=(0,i._)(["\n  cursor: pointer;\n"]);return g=function(){return e},e}function x(){let e=(0,i._)(["\n  position: absolute;\n  z-index: 999;\n\n  bottom: 0;\n  left: 50%;\n  transform: translate(-50%, -30%);\n"]);return x=function(){return e},e}let p=window.innerWidth,w=window.innerHeight,y=e=>e.map(e=>({...e})),b=e=>{let{src:t,shapeProps:n,isSelected:i,onSelect:l,onChange:s,onDragMove:d,onDragEnd:u}=e,[c]=h()(t,"anonymous"),f=(0,o.useRef)(),g=(0,o.useRef)();return(0,o.useEffect)(()=>{i&&g.current.nodes([f.current])},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a._V,{name:"object",image:c,onClick:l,onTap:l,ref:f,...n,draggable:i,onDragMove:e=>{d&&d(e,f.current)},onDragEnd:e=>{s({...n,x:e.target.x(),y:e.target.y()}),u&&u(e)},onTransformEnd:e=>{let t=f.current,i=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),s({...n,x:t.x(),y:t.y(),width:Math.max(5,t.width()*i),height:Math.max(t.height()*r),rotation:t.rotation()}),u&&u(e)}}),i&&(0,r.jsx)(a.Ge,{ref:g,flipEnabled:!1,boundBoxFunc:(e,t)=>5>Math.abs(t.width)||5>Math.abs(t.height)?e:t})]})},m=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),[n,i]=(0,o.useState)([]),[s,h]=(0,o.useState)(null),[u,c]=(0,o.useState)("#fff"),[f,g]=(0,o.useState)(!1),[x,m]=(0,o.useState)([]),[v,M]=(0,o.useState)([]),[S,G]=(0,o.useState)([]),[R,_]=(0,o.useState)(!1),[W,D]=(0,o.useState)(null),H=(0,o.useRef)(null),L=(0,o.useRef)(null),z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;i(e),c(t),m(n=>[...n,{images:y(e),color:t}]),M([])},I=async e=>{if(!e.target.files[0])return;let t=(window.webkitURL||window.URL).createObjectURL(e.target.files[0]),r=new window.Image;r.src=t,r.onload=()=>{let{width:e,height:o}=r,a=[...n,{url:t,id:Math.floor(9999*Math.random())+1,x:e/2/2,y:o/2/2,width:e,height:o,rotation:0,origWidth:r.naturalWidth,origHeight:r.naturalHeight,crop:{x:0,y:0,width:r.naturalWidth,height:r.naturalHeight}}];i(a),z(a)}},N=e=>{e.target===e.target.getStage()&&(h(null),g(!1))},P=()=>{if(x.length<=1)return;let e=x[x.length-2],t=x[x.length-1];i(e.images),c(e.color),m(e=>e.slice(0,-1)),M(e=>[...e,t]),h(null),_(!1)},V=()=>{if(0===v.length)return;let e=v[v.length-1];i(e.images),c(e.color),m(t=>[...t,e]),M(e=>e.slice(0,-1)),_(!1)};(0,o.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key?(e.preventDefault(),P()):e.ctrlKey&&"y"===e.key&&(e.preventDefault(),V())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[x,v]),(0,o.useEffect)(()=>{0===x.length&&m([{images:[],color:"#fff"}])},[]),(0,o.useEffect)(()=>{var t;let n=null===(t=e.current)||void 0===t?void 0:t.container();n&&(n.style.backgroundColor=u)},[u]),(0,o.useEffect)(()=>{L.current&&(L.current.rotateEnabled(!1),L.current.rotateLineVisible(!1))},[R]);let X=t=>{let n=e.current,i=[0,n.width()/2,n.width()],r=[0,n.height()/2,n.height()];return n.find(".object").forEach(e=>{if(e===t)return;let n=e.getClientRect({skipStroke:!0});i.push(n.x,n.x+n.width,n.x+n.width/2),r.push(n.y,n.y+n.height,n.y+n.height/2)}),{vertical:i,horizontal:r}},Y=e=>{let t=e.getClientRect({skipStroke:!0}),n=e.absolutePosition();return{vertical:[{guide:t.x,offset:n.x-t.x,snap:"start"},{guide:t.x+t.width/2,offset:n.x-(t.x+t.width/2),snap:"center"},{guide:t.x+t.width,offset:n.x-(t.x+t.width),snap:"end"}],horizontal:[{guide:t.y,offset:n.y-t.y,snap:"start"},{guide:t.y+t.height/2,offset:n.y-(t.y+t.height/2),snap:"center"},{guide:t.y+t.height,offset:n.y-(t.y+t.height),snap:"end"}]}},A=(e,t)=>{let n=[],i=[];e.vertical.forEach(e=>{t.vertical.forEach(t=>{let i=Math.abs(e-t.guide);i<5&&n.push({lineGuide:e,diff:i,snap:t.snap,offset:t.offset})})}),e.horizontal.forEach(e=>{t.horizontal.forEach(t=>{let n=Math.abs(e-t.guide);n<5&&i.push({lineGuide:e,diff:n,snap:t.snap,offset:t.offset})})});let r=[],o=n.sort((e,t)=>e.diff-t.diff)[0],a=i.sort((e,t)=>e.diff-t.diff)[0];return o&&r.push({lineGuide:o.lineGuide,offset:o.offset,orientation:"V",snap:o.snap}),a&&r.push({lineGuide:a.lineGuide,offset:a.offset,orientation:"H",snap:a.snap}),r},F=(e,t)=>{G([]);let n=A(X(t),Y(t));if(n.length){let e=t.absolutePosition();n.forEach(t=>{switch(t.orientation){case"V":e.x=t.lineGuide+t.offset;break;case"H":e.y=t.lineGuide+t.offset}}),t.absolutePosition(e)}G(n)},T=()=>{G([])};return(0,o.useEffect)(()=>{R&&H.current&&L.current&&(L.current.nodes([H.current]),L.current.getLayer().batchDraw())},[R,W]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.BI,{width:p,height:w,ref:e,onMouseDown:N,onTouchStart:N,children:[(0,r.jsx)(a.Wd,{ref:t,children:n.map((e,t)=>(0,r.jsx)(b,{src:e.url,shapeProps:e,isSelected:e.id===s,onSelect:()=>{h(e.id)},onChange:e=>{let i=n.slice();i[t]=e,z(i)},onDragMove:F,onDragEnd:T},t))}),(0,r.jsx)(a.Wd,{children:S.map((e,t)=>"H"===e.orientation?(0,r.jsx)(a.N1,{points:[-6e3,e.lineGuide,6e3,e.lineGuide],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):"V"===e.orientation?(0,r.jsx)(a.N1,{points:[e.lineGuide,-6e3,e.lineGuide,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:1,dash:[4,6]},t):null)}),R&&W&&(0,r.jsxs)(a.Wd,{children:[(0,r.jsx)(a.rw,{x:W.x,y:W.y,width:W.width,height:W.height,rotation:W.rotation,stroke:"red",dash:[4,4],draggable:!0,onDragEnd:e=>{D({...W,x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{let t=e.target,n=t.scaleX(),i=t.scaleY();D({x:t.x(),y:t.y(),width:Math.max(5,t.width()*n),height:Math.max(5,t.height()*i),rotation:t.rotation()}),t.scaleX(1),t.scaleY(1)},ref:H}),(0,r.jsx)(a.Ge,{ref:L})]})]}),f&&(0,r.jsx)(E,{children:(0,r.jsx)(l.Xq,{color:u,onChange:t=>{e.current.container().style.backgroundColor=t.hex,z(n,t.hex)}})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(j,{children:[(0,r.jsx)("button",{onClick:()=>g(!f),title:"배경색 선택",children:(0,r.jsx)(d.default,{src:"./images/color-picker-icon.png",width:25,height:25,alt:"background-color-picker-icon"})}),(0,r.jsxs)(C,{title:"이미지 추가",children:[(0,r.jsx)(k,{type:"file",id:"file_input",onChange:I}),(0,r.jsx)(d.default,{src:"./images/image-square.png",width:25,height:25,alt:"import-image-icon"})]}),(0,r.jsxs)(C,{title:"이미지 추가",children:[(0,r.jsx)(k,{type:"file",id:"file_input",onChange:I}),(0,r.jsx)(d.default,{src:"./images/plus.png",width:25,height:25,alt:"plus-icon"})]}),(0,r.jsx)("button",{onClick:P,title:"되돌리기 (Ctrl+Z)",children:(0,r.jsx)(d.default,{src:"./images/arrow-u-down-undo.png",width:25,height:25,alt:"undo-icon"})}),(0,r.jsx)("button",{onClick:V,title:"다시 실행 (Ctrl+Y)",children:(0,r.jsx)(d.default,{src:"./images/arrow-u-down-redo.png",width:25,height:25,alt:"redo-icon"})}),!R&&s&&(0,r.jsx)("button",{onClick:()=>{if(!s)return;let e=n.findIndex(e=>e.id===s);if(-1===e)return;let t=n[e];D({x:t.x,y:t.y,width:t.width,height:t.height,rotation:t.rotation}),_(!0)},title:"크롭 모드",children:"Crop"}),R&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{if(!s||!W)return;let e=n.findIndex(e=>e.id===s);if(-1===e)return;let t=n[e],r=t.rotation*Math.PI/180,o=W.x-t.x,a=W.y-t.y,l=Math.cos(-r),d=Math.sin(-r),u=t.crop?t.crop:{x:0,y:0,width:t.origWidth,height:t.origHeight},c=u.width/t.width,f=u.height/t.height,g={x:u.x+(o*l-a*d)*c,y:u.y+(o*d+a*l)*f,width:W.width*c,height:W.height*f},x={...t,x:W.x,y:W.y,width:W.width,height:W.height,crop:g},p=[...n];p[e]=x,i(p),z(p),_(!1),D(null),h(null)},title:"크롭 적용",children:"Confirm Crop"}),(0,r.jsx)("button",{onClick:()=>{_(!1),D(null)},title:"크롭 취소",children:"Cancel Crop"})]})]})})]})},j=u.Ay.div(c()),k=u.Ay.input(f()),C=u.Ay.label(g()),E=u.Ay.div(x())}}]);